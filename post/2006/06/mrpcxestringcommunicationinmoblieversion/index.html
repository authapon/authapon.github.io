<!DOCTYPE HTML>                                                                                                                                   
    <html>
        <head>
            <title>It's me.</title>
            <meta charset="utf-8" />
            <link rel="stylesheet" href="https://authapon.github.io/main.css" />
            <link rel="stylesheet" href="https://authapon.github.io/styles/monokai.css">
        </head>
    <body>
    
    <script type="text/javascript">
    var sc_project=11978914; 
    var sc_invisible=1; 
    var sc_security="daf9dd5b"; 
    </script>
    <script type="text/javascript"
    src="https://www.statcounter.com/counter/counter.js"
    async></script>
    <noscript><div class="statcounter"><a title="Web Analytics
    Made Easy - StatCounter" href="https://statcounter.com/"
    target="_blank"><img class="statcounter"
    src="https://c.statcounter.com/11978914/0/daf9dd5b/1/"
    alt="Web Analytics Made Easy -
    StatCounter"></a></div></noscript>
    
    <script src="https://authapon.github.io/highlight.pack.js"></script>



<div class="main-contain">
    <div class="main-pic"></div>
    <div class="main-content"><div style="padding: 2rem;">
        <h1><a href="https://authapon.github.io/">Home</a> | <a href="#" onclick="history.back();">Back</a></h1>
        <hr>
        <h2>mRPCxe string communication in Moblie Version</h2>
        <h3>Monday, 12 June 2006</h3>
        
        <button type="button" class="tagsbt" onclick="window.open('https:\/\/authapon.github.io\/tags/java')">java</button> 
        
        <br><br><div><p>ผมได้ทดลองเขียนโปรแกรม Java บนมือถือ โดยได้มีการติดต่อสื่อสารกับ Server ผ่านทาง GPRS ซึ่งจะมีการเขียนโปรแกรมผ่าน Socket ผมจึงได้นำโปรแกรมส่ง string ที่ผมเคยเขียนไว้คือ mRPCxe มาแก้ไขให้เป็น Mobile version จึงนำมา post เก็บไว้</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> mRPCxeMB<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.microedition.io.*<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">* @author moo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">mRPCxeMB</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/** Creates a new instance of mRPCxeMB */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">mRPCxeMB</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>DataInputStream in<span style="color:#f92672">,</span> DataOutputStream out<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     String dat<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>             String buf <span style="color:#f92672">=</span> DataInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span>in<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>             String header <span style="color:#f92672">=</span> buf<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>             String body <span style="color:#f92672">=</span> buf<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>             dat<span style="color:#f92672">=</span>dat<span style="color:#f92672">+</span>body<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>header<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)==</span><span style="color:#66d9ef">true</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>                 out<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>header<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;z&#34;</span><span style="color:#f92672">)==</span><span style="color:#66d9ef">true</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> dat<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>DataInputStream in<span style="color:#f92672">,</span> DataOutputStream out<span style="color:#f92672">,</span> String str<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">int</span> wsize<span style="color:#f92672">=</span>1000<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">int</span> countPacket<span style="color:#f92672">=(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Math</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ceil</span><span style="color:#f92672">((</span><span style="color:#66d9ef">float</span><span style="color:#f92672">)</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()/(</span><span style="color:#66d9ef">float</span><span style="color:#f92672">)</span>wsize<span style="color:#f92672">));</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">int</span> pos<span style="color:#f92672">=</span>0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>         String buf<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>             countPacket<span style="color:#f92672">--;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>countPacket<span style="color:#f92672">&gt;</span>0<span style="color:#f92672">){</span>
</span></span><span style="display:flex;"><span>                 buf<span style="color:#f92672">=</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>pos<span style="color:#f92672">,</span> pos<span style="color:#f92672">+</span>wsize<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                 pos<span style="color:#f92672">=</span>pos<span style="color:#f92672">+</span>wsize<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>                 out<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">+</span>buf<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                 String res <span style="color:#f92672">=</span> DataInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span>in<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>res<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;x&#34;</span><span style="color:#f92672">))</span> <span style="color:#66d9ef">continue</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                 buf<span style="color:#f92672">=</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>pos<span style="color:#f92672">,</span> str<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
</span></span><span style="display:flex;"><span>                 out<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;z&#34;</span><span style="color:#f92672">+</span>buf<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">ClientSend</span><span style="color:#f92672">(</span>String tx<span style="color:#f92672">,</span>String host<span style="color:#f92672">,</span>String port<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>     String ret<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>         StreamConnection s <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>StreamConnection<span style="color:#f92672">)</span>Connector<span style="color:#f92672">.</span><span style="color:#a6e22e">open</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;socket://&#34;</span><span style="color:#f92672">+</span>host<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;:&#34;</span><span style="color:#f92672">+</span>port<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         DataInputStream in <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">openDataInputStream</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>         DataOutputStream out <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">openDataOutputStream</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>         write<span style="color:#f92672">(</span>in<span style="color:#f92672">,</span> out<span style="color:#f92672">,</span> tx<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         ret <span style="color:#f92672">=</span> read<span style="color:#f92672">(</span>in<span style="color:#f92672">,</span> out<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">return</span> ret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">){</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">return</span> ret<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">}</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></div>
        <br><hr>
        <h1><a href="https://authapon.github.io/">Home</a> | <a href="#" onclick="history.back();">Back</a></h1>
    </div></div>
</div>
    <script>hljs.initHighlightingOnLoad();</script>
    </body>                                                                                                                                        
</html>

